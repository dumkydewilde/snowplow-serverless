function urlParamsToObject(urlParams) {
  let result = {};
  urlParams.split("&").forEach(function(part) {
    const item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}

function processTrafficQuality(event) {  
  const botList = "Majestic12,Anarchy99,MoodleBot,baidu,Siteimprove.com,WebLeacher,Surfbot,EyeNetIE,yacybot,Validator\\.nu,DittoSpyder,Cosmos,[^a]fish,BBBike,Microsoft\\ Data\\ Access,Twitterbot,httrack,PHPCrawl,NINJA bot,Y!J,Mozlila,Firefox/7.0,Grobbot,Collector,Mister\\ PiX,Xaldon\\ WebSpider,MarcEdit,mediapartners-google,zauba.io,FDM(\\s|\\+)\\d,SocialRankIOBot,ia_archiver,RyteBot,^Buck\\/[0-9],bwh3_user_agent,Zitebot,LinkWalker,CheeseBot,James BOT,Jbrofuzz,fedoraplanet,feedbot,crawler4j,lwp-trivial,fr-crawler,OurBrowser,Bot.AraTurka.com,bitlybot,axios,sp_auditbot,Widow,heritrix,pear\\.php\\.net,DTS Agent,YandexTurbo,Mb2345Browser,DataCha0s,Clickagy,Piepmatz,^Opera\\/4$,favorg,Seekport,PR-CY.RU,Vacuum,LinkedInBot,eright,CherryPicker,speedy,http_get,facebookscraper,rssbot\\/,Mediapartners-Google,slurp,x09Mozilla,HTMLparser,SemanticScholarBot,e\\.ventures Investment Crawler,Unpaywall,ZoominfoBot,Fetch\\/,brainobot,Docoloc,Yeti\\/\\d,spyfu,Cincraw,DIIbot,FHscan,LinksManager,CCBot,FlipboardProxy,SWIMGBot,Swiftbot,Aspiegel,SpankBot,DomCopBot,Sitevigil,discobot,Microsoft-WebDAV-MiniRedir,JustView,parsijoo,webmirror,Indy Library,Download\\ Wonder,europarchive.org,Discoverybot,domainsproject.org,bookmark-manager,CazoodleBot,Buddy,Pcore-HTTP,Telesphorep,Bytespider,lssrocketcrawler,LeechGet,aiHitBot,Xenu Link Sleuth,wocbot,gvfs\\/,Ahrefs(Bot|SiteAudit),Cortana,Discordbot,tweetedtimes,Readpaper,PictureFinder,dataforseobot,semanticbot,Ltx71,ScreenerBot,Gwene,validator,ezooms,Fever,^user.?agent$,netresearchserver,jpg-newsbot,Qwantify,rogerbot,SearchmetricsBot,GetWeb,Nuclei,nagios,Abonti,Rogerbot,EveryoneSocialBot,Caliperbot,Seomoz,SentiBot,GetRight,Datanyze,ZuperlistBot\\/,trendiction.com,Voltron,sitechecker.pro,elisabot,Atom Feed Robot,msrbot,jyxobot,webpros.com,FeedValidator,Bullseye,Arachmo,SEOprofiler,Flunky,LinkScan,SafeDNSBot,^Mozilla$,MSIECrawler,NIXStatsbot,panscient,Alligator,SiteSucker,ContextAd Bot,W3C_CSS_Validator,Getintent,Dataprovider.com,Digincore bot,MetaURI,Tracemyfile,Anarchie,DeuSu\\/,Hatena,YandexAccessibilityBot,RankurBot,^Array$,OrangeBot,netEstate NE Crawler,ltx71,API[\\+\\s]scraper,ColdFusion,WinHTTrack,Bitacle,Papa\\ Foto,ucsd,boitho\\.com-dc,Spinn3r,Custo,Extreme\\ Picture\\ Finder,Multiviewbot,plumanalytics,HTTP::Lite,y!j,W3C-mobileOK,RebelMouse,Sucker,summify,arks,IlseBot,(^| )sentry\\/,BitBot,7siters,DatabaseDriverMysqli,Aboundex,cursor,SMTBot,FAST Enterprise Crawler,NetSpider,Feedbin,URL2File,startmebot\\/,lilina,findthatfile,tagoobot,GrabNet,Jetty,Curious,007ac9 Crawler,MaCoCu,scooter,Rivva,JikeSpider,Gigabot,outbrain,lssbot,EirGrabber,gnam gnam spider,Alexandria(\\s|\\+)prototype(\\s|\\+)project,Xenu,Lmspider,SiteLockSpider,PaperLiBot,Uptime-Kuma,Arachni,python-requests,centurybot,toplistbot,NetcraftSurveyAgent,Aipbot,ScoutJet,Nimbostratus-Bot,ProWebWalker,Blackboard[\\+\\s]Safeassign,YaDirectFetcher,Acunetix,BTWebClient,BrandONbot,EThOS\\+\\(British\\+Library\\),StorygizeBot,Mediatoolkitbot,^Ning\\/\\d,EroCrawler,BuiltBotTough,DomainSigmaCrawler,Code\\sSample\\sWeb\\sClient,Picscout,seoscanners,WebBandit,axios\\/\\d,^Mozilla\\/4\\.0\\+\\(compatible;\\+ICS\\)$,Luminator-robots,fuelbot,Toata,WebDataStats,Domains Project\\/,HonoluluBot,404enemy,Webinator,Datafeedwatch,betaBot,Cegbfeieh,Who.is\\ Bot,BingPreview,Crawling\\ at\\ Home\\ Project,^NetAnts\\/\\d,webprosbot,Calculon,serpstatbot\\/,WPScan,ArchiveBot,Google Web Preview,WWW::Mechanize,ZumBot,Sogou,Kinza,AhrefsBot,ECCP/1.0,LinkpadBot,YandexNews,BoxcarBot,tAkeOut,Cookiebot,HTTPFetcher,webcollage,crawl,Googlebot-News,Dragonfly,Linkbot,MicroMessenger,MolokaiBot,Web\\ Enhancer,daum(oa)?,^Mozilla.4\\.0$,Mr.4x3,psbot,SuperHTTP,Seekport Crawler,BacklinkCrawler,yanga,urlaliasbuilder,WWW-Collector-E,TinEye,Gotit,Landau-Media-Spider,bingbot,Traackr.com,^LinkParser\\/,DigitalPebble,zenback bot,404checker,CSHttp,BazQux,Wonderbot,moatbot,link.?check,MIDown\\ tool,Microsoft Office Protocol Discovery,OutclicksBot,YisouSpider,sitebot,GLMSLinkAnalysis,satoristudio.net,YandexTracker,GermCrawler,g2reader-bot,sexsearcher,Pixray,BackWeb,linkwalker,webgains-bot,Dubbotbot,Lanshanbot,CC Metadata Scaper,^ruby$,lycos[_+],dotbot,eCatch,FAST-WebCrawler,PageScorer,Slack-ImgProxy,PyCurl,ZoteroTranslationServer,GnowitNewsbot,playmusic\\.com,almaden,CrystalSemanticsBot,Apercite,bloglines,^Mozilla\\/5.0\\+\\(compatible;\\+MSIE\\+6\\.0;\\+Windows\\+NT\\+5\\.0\\)$,Taboolabot,NetAnts,seekbot,Chrome-Lighthouse,content crawler spider,NetMechanic,DomainCrawler,postrank,^Filter$,YandexMobileScreenShotBot,netluchs,webmeup-crawler,robozilla,MuckRack,^LCC ,asterias,yacy,Google Favicon,Moreover,ALittle\\ Client,linkscan,Harvest,SkypeUriPreview,YoudaoBot,SemrushBot,ng\\/2\\.,W3C_I18n-Checker,Quick-Crawler,K7MLWCBot,T8Abot,PhantomJS,Moblie Safari,GigablastOpenSource,VidibleScraper,Nameprotect,Grammarly,Express\\ WebPictures,Webster,Streamline3Bot\\/,VB\\ Project,iktomi,LinkArchiver,tigerbot,MegaIndex.ru,Sitebeam,newspaper\\/\\d,CensysInspect,ChinaClaw,Re-re,Scanbot,Digincore,no_user_agent,UnisterBot,Bark[rR]owler,Siteimprove,Google-PhysicalWeb,YandexImageResizer,InternetSeer,Fuzz,Metauri,tracemyfile,WBSearchBot,FrontPage,G2 Web Services,binlar,scribdbot,MBCrawler,^.?$,WebsiteQuester,Thinklab,Ezooms,Vigil\\/,scalaj-http,Stripper,HubSpot,PHP\\/,feedreader,Demon,Pavuk,DuckDuckGo-Favicons-Bot,Black\\ Hole,Googlebot-Video,wotbox,SISTRIX,imrbot,ToutiaoSpider,DBLBot,arabot,Twingly,ips-agent,MIIxpc,Google-Site-Verification,webmon,Asterias,EMail\\ Wolf,BuzzSumo,SBL-BOT,BDCbot,domaincrawler,SimplePie,Crescent,ScrepyBot,SurveyBot,ip-web-crawler.com,datagnionbot,Sogou\\ web\\ spider,jobo,OnCrawl,it2media-domain-crawler,WebGo\\ IS,EmailWolf,findlink,Leikibot,Baidu-YunGuanCe,Neticle Crawler,Goldfire(\\s|\\+)Server,Fetch(\\s|\\+)API(\\s|\\+)Request,httpunit,buzzbot,Embedly,facebookexternalhit\\/,RankingBot2,TangibleeBot,IRLbot,^Postgenomic(\\s|\\+)v2,Bolt,netEstate\\ NE\\ Crawler,IstellaBot,Amazonbot,sqlmap,WebWhacker,MFC_Tear_Sample,Freeuploader,NextGenSearchBot,SiteExplorer,PxBroker,Web\\ Fetch,^Mozilla\\/4\\.0\\+\\(compatible;\\)$,ExtLinksBot,^Mozilla\\/5\\.0\\+like\\+Gecko$,Offline\\ Navigator,wordpress,ferret,OrangeSpider,^oaDOI$,Veoozbot,IonCrawl,Evil,appie,JetCar,Magnet,weblayers,SeekportBot,internetseer,httpget,scan4mail,bnf.fr_bot,changedetection,KosmioBot,cXensebot,livejournal\\.com,DnBCrawler-Analytics,myweb,Kemvibot,Feedfetcher-Google,PiplBot,Buck\\/,Virusdie,Offline(\\s|\\+)Navigator,twengabot,Netvibes,SurdotlyBot,intute,Sucuri,onetszukaj,Go!Zilla,webcompanycrawler,SearchBloxIntra,Discobot,Apexoo,gslfbot,http.?client,Libwhisker,T0PHackTeam,RankActive,ScanAlert,mediawords,OpenLinkProfiler,PeoplePal,ReGet,Fyrebot,coccoc\\/1\\.0,Strider,PetalBot,WebReaper,UsineNouvelleCrawler,Leap,Cutbot,Download\\+Master,The[\\+\\s]Knowledge[\\+\\s]AI,awesomecrawler,BetaBot,worm,LinqiaScrapeBot,MarkWatch,Pi-Monster,seewithkids,Jorgee,libhttp,^Mozilla\\/4\\.5\\+\\[en]\\+\\(Win98;\\+I\\)$,SuperBot,WebFetch,archive.org_bot,(^| )PTST\\/,ZoomBot,YandexMetrika,The\\ Intraformant,holmes,PageGrabber,drupact,Niki-bot,Foobot,MojeekBot\\/,Deusu,FreshRSS,^LinkSaver\\/,Disco,CheTeam,Jamie's Spider,WebmasterWorldForumBot,Slurp,acapbot,blaiz-bee,virus.detector,bot-pge.chlooe.com,urllib,voila,Site24x7,niki-bot,V-BOT,Python-urllib,g00g1e.net,PycURL,WebCollage,Iblog,Octopus,google-xrawler,combine,exabot,Ecxi,web-archive-net.com.bot,CyberPatrol,aiohttp,YandexRCA,CyotekWebCopy,ZmEu,Psbot,ocelli,Meanpathbot,RidderBot,WISENutbot,findxbot,Google-Structured-Data-Testing-Tool,Brandprotect,libwww,[pP]ingdom,^MSIE,weborama-fetcher,Sosospider,Webalta,LinkLint-checkonly,LinkTiger,FlashGet,Google-Adwords-Instant,AppInsights,RankActiveLinkBot,WeSEE:Search,Alexibot,Zermelo,Riddler,iubenda-radar,CheckMarkNetwork\\/,Koha,muhstik-scan,Panscient,MetaJobBot,bjaaland,Screaming Frog SEO Spider,Sqworm,AndersPinkBot,www\\.gnip\\.com,Tiny Tiny RSS,ExtractorPro,pcBrowser,Joomla,yandex,AfD-Verbotsverfahren,G-i-g-a-b-o-t,harvest,Grafula,SEOkicks-Robot,pidcheck,OpenVAS,Turingos,OutfoxBot,YandexBot,Web\\ Sauger,^PHP-Curl-Class,docomo,BotALot,HttpComponents\\/1.1,Microsoft Office Existence Discovery,Recorder,Teoma,htmlparser,Keyword\\ Density,GT::WWW,LinqiaMetadataDownloaderBot,easydl,Nutch,edisterbot,NING\\/,MixnodeCache\\/,Toweyabot,collection@infegy.com,UT-Dorkbot,Feedspot,Nimbostratus,webreaper,Experibot,YandexDirect,^FileDown$,EMail\\ Siphon,Cocolyzebot,YandexImages,Masscan,Image\\ Sucker,URLy\\ Warning,okhttp,Voil,YandexWebmaster,Havij,Intelliseek,B2B Bot,Domains\\ Project,Turnitin,grub.org,com.plumanalytics,PageThing.com,EZID,Mojolicious,crawl.sogou.com,Teleport(\\s|\\+)Pro,W3C_Unicorn,GarlikCrawler,T\\-H\\-U\\-N\\-D\\-E\\-R\\-S\\-T\\-O\\-N\\-E,Pockey,intelium_bot,FindITAnswersbot,Genieo,architext,Vagabondo,WordupInfoSearch,Webshag,htdig,Mojeek,Web\\ Collage,SpaceBison,WEBDAV,check_http,AdsTxtCrawlerTP,WebZIP,OgScrper,Webmetrics,01h4x.com,zgrab,Bigfoot,Viber,Jersey\\/\\d,[Cc]urebot,Nuzzel,Nessus,^IDA$,Google-Certificates-Bridge,IDBot,W3C-checklink,SiteCheckerBotCrawler,ultraseek,Sqlworm,NTENTbot,NimbleCrawler,Blackboard,DuckDuckBot,Snacktory,EasyBib[\\+\\s]AutoCite[\\+\\s],DnyzBot,WebPix,SrceDAMP,page2rss,WiseGuys\\ Robot,iskanie,fluffy,SenutoBot,msnbot,LongURL.API,shoutcast,SmartDownload,ichiro,JOC\\ Web\\ Spider,^脝脝陆芒潞贸碌脛$,wbsearchbot,Net\\ Vampire,Googlebot-Mobile,Jetslide,trendictionbot,EmailSiphon,DomainStatsBot,^LinkAnalyser,lwp,alexa,arquivo.pt,ContentSmartz,BLEXBot,careerbot,OrangeBot\\/,^Pattern\\/\\d,Anthill,Zabbix,Cloud\\ mapping,Snake,^java\\/\\d{1,2}.\\d,AdvBot,ArchiveTeam,Laserlikebot,BIGLOTRON,purebot,sistrix crawler,lb-spider,Web\\ Auto,NearSite,Digg Deeper,aria2\\/\\d,MeltwaterNews,omgili,Jooblebot,Refindbot,playstarmusic\\.com,YandexForDomain,RealDownload,findlinks,Zade,AdsBot-Google([^-]|$),Microsoft\\ URL\\ Control,xenu,360Spider,GalaxyBot,HEADMasterSEO,Drip,SEOlyticsCrawler,MQQBrowser,Offline\\ Explorer,urlappendbot,YandexMedia,ripz,MetaURI[\\+\\s]API\\/\\d\\.\\d,com\\.plumanalytics,HTTrack,Lipperhey\\ Spider,Amazon CloudFront,RSSingBot,minicrawler,smtbot,Name\\ Intelligence,feedburner,SalesIntelligent,Woobot,Majestic-SEO,YandexPartner,sogou,ilse,VoidEYE,Image\\ Fetch,Gluten Free Crawler\\/,NICErsPRO,Whack,Id-search,BackStreet,Livelap[bB]ot,Gigablast,AISearchBot,SafeSearch microdata crawler,^User-Agent,Snoopy,BomboraBot,IndeedBot,Internet\\ Ninja,Iria,Nmap,Trendiction,nutch,RetrevoPageAnalyzer,FeedFetcher,Rankivabot,internetVista\\ monitor,YandexSearchShop,nomad,^undefined$,Whatweb,Barkrowler,HttpUrlConnection,WallpapersHD,MeanPath\\ Bot,JamesBOT,w3af\\.org,RocketCrawler,BublupBot,mimas,Suzuran,LinkextractorPro,isitwp.com,phpcrawl,AppEngine-Google,acoonbot,Sociscraper,xpymep1.exe,UptimeRobot,Brandwatch,Wallpapers/3.0,Disqus,seocompany.store,WebStripper,SlySearch,moget,Funnelback,Pandalytics,Reaper,TeleportPro,Titan,FDM,VoluumDSP-content-bot,Proximic,siteripz,larbin,Diffbot\\/,MuscatFerre,Atomseobot,spider,CATExplorador,VCI,titan,WWWOFFLE,Hloader,VKRobot,ADmantX,Petalbot,x22Mozilla,antibot,Primalbot,LibWeb,Backlink-Ceck,oBot,Daum\\/,Wanadoo,Nmap Scripting Engine,JennyBot,electricmonk,core,^破解后的$,YandexVideo,Siphon,Haansoft,twiceler,AwarioRssBot,Indy\\ Library,RuxitSynthetic,YandexFavicons,PagePeeker\\/,Kenjin\\ Spider,Openfind,Ninja,Slackbot,Lightspeedsystems,GridBot,Chlooe,AiHitBot,Copier,Snap URL Preview Service,backlink-check,PocketParser,Nibbler,PECL::HTTP,Probethenet,Mediapartners \\(Googlebot\\),AdsTxtCrawler,Jyxobot,Musobot,QueryN\\ Metasearch,proximic,TrendsmapResolver,TwengaBot,megite,Twurly,instabid,trendiction.de,Drupal,virustotal,SEOkicks,SBIder,netcraft,scirus,clark-crawler,Superfeedr,rambler,epicbot,page\\ scorer,www\\.uptime\\.com,Battleztar\\ Bazinga,memorybot,GrapeFX,HaosouSpider,Site\\ Sucker,s1z.ru,Zeus,Googlebot\\/,InterfaxScanBot,Google-Read-Aloud,ubermetrics-technologies.com,DSurf,Ankit,NerdByNature.Bot,Szukacz,True_Robot,theoldreader.com,Semrush,SputnikBot,BatchFTP,BehloolBot,jeeves,^curl,AllenTrack,Badass,SimpleScraper,blogmuraBot,BrandVerity,W3C_Validator,YandexAdNet,meanpathbot,BunnySlippers,Citoid,Craftbot,^firefox$,cognitiveseo,Companybook-Crawler,VeriCiteCrawler,blogpulse,sunrise,voyagerx.com,AspiegelBot,Twice,YaK\\/,cah.io.community,PrivacyAwareBot,serpstatbot,Yahoo Link Preview,Xaldon_WebSpider,YandexVertis,redditbot,gulliver,MJ12bot,InterGET,Lipperhey,Scrapy,autoemailspider,^unknown$,MauiBot,Sysomos,CrunchBot,Gowikibot,HeadlessChrome,DTS\\ Agent,Spbot,NAVER Blog Rssbot,CopyRightCheck,MarkMonitor,iSiloX,Copyscape,RankingBot,vkShare,BlowFish,python,NPbot,DataCha0s\\/2\\.0,pioneer,^Traackr\\.com$,Netcraft,LieBaoFast,NextCloud,BlackWidow,ELinks\\/,Scrapy\\/\\d,Fimap,TheNomad,Screaming,China\\sLocal\\sBrowse\\s2\\.6,BackDoorBot,AddThis,deadlinkchecker,mappydata,yahoo,Uptimebot\\.org,Fulltext,coccocbot,BUbiNG,WebSucker,TurnitinBot,Openvas,Go-http-client,IAS crawler,Baiduspider,Mail.RU_Bot,MegaIndex,Cogentbot,adscanner,FemtosearchBot,PageAnalyzer,Shodan,Msrabot,SEOstats,Pu_iN,evc-batch,Typhoeus,trovitBot,^Apache-HttpClient,Trendictionbot,lwp-request,SimpleCrawler,YandexBlogs,S[eE][mM]rushBot,Faveeo\\/\\d,AwarioSmartBot,DomainAppender,Web(\\s|\\+)Downloader,SeoSiteCheckup,Picsearch,convera,siteexplorer.info,MTRobot,dataforseo.com,YandexMobileBot,Dragonbot,celestial,perman,^Mozilla.5\\.0$,Microsoft(\\s|\\+)URL(\\s|\\+)Control,AllSubmitter,curl\\/,mnogosearch,AIBOT,InfoTekies,Mag-Net,A6-Indexer,officestorebot,80legs,WASALive-Bot,BDFetch,WebSauger,facebookexternalhit,LOCKSS,Feedly,DSearch,Spammen,Keybot\\ Translation-Search-Machine,EasyDL,HybridBot,SiteSnagger,scan.lol,Upflow,Ripper,kyluka,arquivo-web-crawler,Miniflux\\/,SerendeputyBot,custo,demandbase-bot,WebCloner,AHC\\/,Bandit,Sqlmap,linkdexbot,Cliqzbot,Dispatch\\/\\d,POE-Component-Client-HTTP,VelenPublicWebCrawler,Exabot,ASPSeek,mindUpBot,coccoc,Yeti,botify,BLEXBot\\/,spbot,WebEnhancer,AnyEvent,linkdex,Devil,backlinkcrawler,Mata\\ Hari,Morfeus\\ Fucking\\ Scanner,CrazyWebCrawler,seostar\\.co,^@ozilla\\/\\d,Googlebot-Image,CoverScout,checklink,cfnetwork,Extractor,MSFrontPage,GrapeshotCrawler,Snapbot,2ip.ru,yoozBot,ReactorNetty\\/\\d,pinterest.com.bot,FyberSpider,BingPreview\\/,Attach,Go-Ahead-Got-It,check1.exe,libcurl,CriteoBot,Jugendschutzprogramm-Crawler,tailrank,RedesScrapy,APIs-Google,Better Uptime Bot,crawler.feedback,contentmatch,Wallpapers,Adidxbot,motor,Zauba,GingerCrawler,CakePHP,ICC-Crawler,GroupHigh\\/\\d,YandexCalendar,NetLyzer,LinkisBot,Claritybot,SeobilityBot,Dirbuster,GroupHigh\\/,libwww-perl,TweetmemeBot,Heritrix,citeseerxbot,google,Navroad,Iskanie,YandexVerticals,WWW-Mechanize,Spanner,seobility,lipperhey,seznambot,Minefield,Cliqzbot\\/,ZyBorg,WebCopier,YandexPagechecker,cloakDetect,atomz,IDBTE4M,Wget,YandexOntoDB,YandexMarket,mail\\.ru,PleaseCrawl,magpie-crawler,^Mozilla\\/5.0(\\s|\\+)Gecko\\/20100115(\\s|\\+)Firefox\\/3.6$,CODE87,bot,voilabot,^integrity\\/\\d,[wW]get,URLy.Warning,Larbin,Ocarinabot,Lftp,Eyeotabot,SemanticJuice,Telesoft,geturl,nerdybot,Web\\ Sucker,linkapediabot,Betsie,LexiBot,xovibot,TightTwatBot,^voltron$,^FOCA,Litemage_walker,Likse,Friendica,Pimonster,Buck,seostar,AddSearchBot,Sonic,zyborg,woobot,WhatsApp,Pulsepoint,gopher,Mastodon,LeechFTP,httpx,Page\\ Analyzer,Humanlinks,Teleport,Telesphoreo,YandexScreenshotBot,voyager\\/,contxbot,WebImageCollector,rss,bidswitchbot,Whacker,Dotbot,filterdb.iss.net\\/crawler,Trello,Majestic\\ SEO,Mass\\ Downloader,LinqiaRSSBot,FreeWebMonitoring SiteChecker,powermarks,Thumbor,um-LN,crusty\\/\\d,CloudFlare-AlwaysOnline,WebsiteExtractor,openindexspider,infoobot,Applebot,HMView,sogouspider,RepoMonkey,CapsuleChecker,JobboerseBot,LWP::Simple,RankFlex,DareBoost,Searchestate,integromedb,Kozmosbot,probe-image-size,EcoSearch,online-webceo-bot,woriobot,ProPowerBot,newspaper\\/,YandexSpravBot,Flamingo_SearchEngine,SearchAtlas,Grabber,ICBot\\/,NetZIP,Boardreader,Facebot,Dispatch,newsharecounts,Website\\ Quester,scientificcommons,Needle,polaris\\ version,^scrutiny\\/\\d,InfoNaviRobot,zeus,checkprivacy,RegionStuttgartBot,LNSpiderguy,AlphaBot,sysscan,Brutus\\/AET,biglotron,WeSEE,webmon ,Web\\ Fuck,TelegramBot,WebAuto,adbeat_bot,Aboundexbot,Anarchy,Linguee Bot,Pump,BLP_bbot,GoZilla,YandexSitelinks,BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher,OpenHoseBot,Steeler,Wotbox,ec2linkfinder,grub,BuiltWith,Domain Re-Animator Bot,Ebingbong,Web\\ Pix,Nettrack,Nikto,^\\%?default\\%?$,EBSCO\\sEJS\\sContent\\sServer,dcrawl,FreshpingBot,vebidoobot,Wprecon,Trove,redalert,Sottopop,WebFuck,AdsBot-Google-Mobile,Blow,mlbot"
  const bots = botList.split(",");

  const crawlersList = "Googlebot\\/,Googlebot-Mobile,Googlebot-Image,Googlebot-News,Googlebot-Video,AdsBot-Google([^-]|$),AdsBot-Google-Mobile,Feedfetcher-Google,Mediapartners-Google,Mediapartners \\(Googlebot\\),APIs-Google,bingbot,Slurp,[wW]get,LinkedInBot,Python-urllib,python-requests,aiohttp,httpx,libwww-perl,httpunit,nutch,Go-http-client,phpcrawl,msnbot,jyxobot,FAST-WebCrawler,FAST Enterprise Crawler,BIGLOTRON,Teoma,convera,seekbot,Gigabot,Gigablast,exabot,ia_archiver,GingerCrawler,webmon ,HTTrack,grub.org,UsineNouvelleCrawler,antibot,netresearchserver,speedy,fluffy,findlink,msrbot,panscient,yacybot,AISearchBot,ips-agent,tagoobot,MJ12bot,woriobot,yanga,buzzbot,mlbot,YandexBot,YandexImages,YandexAccessibilityBot,YandexMobileBot,YandexMetrika,YandexTurbo,YandexImageResizer,YandexVideo,YandexAdNet,YandexBlogs,YandexCalendar,YandexDirect,YandexFavicons,YaDirectFetcher,YandexForDomain,YandexMarket,YandexMedia,YandexMobileScreenShotBot,YandexNews,YandexOntoDB,YandexPagechecker,YandexPartner,YandexRCA,YandexSearchShop,YandexSitelinks,YandexSpravBot,YandexTracker,YandexVertis,YandexVerticals,YandexWebmaster,YandexScreenshotBot,purebot,Linguee Bot,CyberPatrol,voilabot,Baiduspider,citeseerxbot,spbot,twengabot,postrank,TurnitinBot,scribdbot,page2rss,sitebot,linkdex,Adidxbot,ezooms,dotbot,Mail.RU_Bot,discobot,heritrix,findthatfile,europarchive.org,NerdByNature.Bot,sistrix crawler,Ahrefs(Bot|SiteAudit),fuelbot,CrunchBot,IndeedBot,mappydata,woobot,ZoominfoBot,PrivacyAwareBot,Multiviewbot,SWIMGBot,Grobbot,eright,Apercite,semanticbot,Aboundex,domaincrawler,wbsearchbot,summify,CCBot,edisterbot,seznambot,ec2linkfinder,gslfbot,aiHitBot,intelium_bot,facebookexternalhit,Yeti,RetrevoPageAnalyzer,lb-spider,Sogou,lssbot,careerbot,wotbox,wocbot,ichiro,DuckDuckBot,lssrocketcrawler,drupact,webcompanycrawler,acoonbot,openindexspider,gnam gnam spider,web-archive-net.com.bot,backlinkcrawler,coccoc,integromedb,content crawler spider,toplistbot,it2media-domain-crawler,ip-web-crawler.com,siteexplorer.info,elisabot,proximic,changedetection,arabot,WeSEE:Search,niki-bot,CrystalSemanticsBot,rogerbot,360Spider,psbot,InterfaxScanBot,CC Metadata Scaper,g00g1e.net,GrapeshotCrawler,urlappendbot,brainobot,fr-crawler,binlar,SimpleCrawler,Twitterbot,cXensebot,smtbot,bnf.fr_bot,A6-Indexer,ADmantX,Facebot,OrangeBot\\/,memorybot,AdvBot,MegaIndex,SemanticScholarBot,ltx71,nerdybot,xovibot,BUbiNG,Qwantify,archive.org_bot,Applebot,TweetmemeBot,crawler4j,findxbot,S[eE][mM]rushBot,yoozBot,lipperhey,Y!J,Domain Re-Animator Bot,AddThis,Screaming Frog SEO Spider,MetaURI,Scrapy,Livelap[bB]ot,OpenHoseBot,CapsuleChecker,collection@infegy.com,IstellaBot,DeuSu\\/,betaBot,Cliqzbot\\/,MojeekBot\\/,netEstate NE Crawler,SafeSearch microdata crawler,Gluten Free Crawler\\/,Sonic,Sysomos,Trove,deadlinkchecker,Slack-ImgProxy,Embedly,RankActiveLinkBot,iskanie,SafeDNSBot,SkypeUriPreview,Veoozbot,Slackbot,redditbot,datagnionbot,Google-Adwords-Instant,adbeat_bot,WhatsApp,contxbot,pinterest.com.bot,electricmonk,GarlikCrawler,BingPreview\\/,vebidoobot,FemtosearchBot,Yahoo Link Preview,MetaJobBot,DomainStatsBot,mindUpBot,Daum\\/,Jugendschutzprogramm-Crawler,Xenu Link Sleuth,Pcore-HTTP,moatbot,KosmioBot,[pP]ingdom,AppInsights,PhantomJS,Gowikibot,PiplBot,Discordbot,TelegramBot,Jetslide,newsharecounts,James BOT,Bark[rR]owler,TinEye,SocialRankIOBot,trendictionbot,Ocarinabot,epicbot,Primalbot,DuckDuckGo-Favicons-Bot,GnowitNewsbot,Leikibot,LinkArchiver,YaK\\/,PaperLiBot,Digg Deeper,dcrawl,Snacktory,AndersPinkBot,Fyrebot,EveryoneSocialBot,Mediatoolkitbot,Luminator-robots,ExtLinksBot,SurveyBot,NING\\/,okhttp,Nuzzel,omgili,PocketParser,YisouSpider,um-LN,ToutiaoSpider,MuckRack,Jamie's Spider,AHC\\/,NetcraftSurveyAgent,Laserlikebot,^Apache-HttpClient,AppEngine-Google,Jetty,Upflow,Thinklab,Traackr.com,Twurly,Mastodon,http_get,DnyzBot,botify,007ac9 Crawler,BehloolBot,BrandVerity,check_http,BDCbot,ZumBot,EZID,ICC-Crawler,ArchiveBot,^LCC ,filterdb.iss.net\\/crawler,BLP_bbot,BomboraBot,Buck\\/,Companybook-Crawler,Genieo,magpie-crawler,MeltwaterNews,Moreover,newspaper\\/,ScoutJet,(^| )sentry\\/,StorygizeBot,UptimeRobot,OutclicksBot,seoscanners,Hatena,Google Web Preview,MauiBot,AlphaBot,SBL-BOT,IAS crawler,adscanner,Netvibes,acapbot,Baidu-YunGuanCe,bitlybot,blogmuraBot,Bot.AraTurka.com,bot-pge.chlooe.com,BoxcarBot,BTWebClient,ContextAd Bot,Digincore bot,Disqus,Feedly,Fetch\\/,Fever,Flamingo_SearchEngine,FlipboardProxy,g2reader-bot,G2 Web Services,imrbot,K7MLWCBot,Kemvibot,Landau-Media-Spider,linkapediabot,vkShare,Siteimprove.com,BLEXBot\\/,DareBoost,ZuperlistBot\\/,Miniflux\\/,Feedspot,Diffbot\\/,SEOkicks,tracemyfile,Nimbostratus-Bot,zgrab,PR-CY.RU,AdsTxtCrawler,Datafeedwatch,Zabbix,TangibleeBot,google-xrawler,axios,Amazon CloudFront,Pulsepoint,CloudFlare-AlwaysOnline,Google-Structured-Data-Testing-Tool,WordupInfoSearch,WebDataStats,HttpUrlConnection,Seekport Crawler,ZoomBot,VelenPublicWebCrawler,MoodleBot,jpg-newsbot,outbrain,W3C_Validator,Validator\\.nu,W3C-checklink,W3C-mobileOK,W3C_I18n-Checker,FeedValidator,W3C_CSS_Validator,W3C_Unicorn,Google-PhysicalWeb,Blackboard,ICBot\\/,BazQux,Twingly,Rivva,Experibot,awesomecrawler,Dataprovider.com,GroupHigh\\/,theoldreader.com,AnyEvent,Uptimebot\\.org,Nmap Scripting Engine,2ip.ru,Clickagy,Caliperbot,MBCrawler,online-webceo-bot,B2B Bot,AddSearchBot,Google Favicon,HubSpot,Chrome-Lighthouse,HeadlessChrome,CheckMarkNetwork\\/,www\\.uptime\\.com,Streamline3Bot\\/,serpstatbot\\/,MixnodeCache\\/,^curl,SimpleScraper,RSSingBot,Jooblebot,fedoraplanet,Friendica,NextCloud,Tiny Tiny RSS,RegionStuttgartBot,Bytespider,Datanyze,Google-Site-Verification,TrendsmapResolver,tweetedtimes,NTENTbot,Gwene,SimplePie,SearchAtlas,Superfeedr,feedbot,UT-Dorkbot,Amazonbot,SerendeputyBot,Eyeotabot,officestorebot,Neticle Crawler,SurdotlyBot,LinkisBot,AwarioSmartBot,AwarioRssBot,RyteBot,FreeWebMonitoring SiteChecker,AspiegelBot,NAVER Blog Rssbot,zenback bot,SentiBot,Domains Project\\/,Pandalytics,VKRobot,bidswitchbot,tigerbot,NIXStatsbot,Atom Feed Robot,[Cc]urebot,PagePeeker\\/,Vigil\\/,rssbot\\/,startmebot\\/,JobboerseBot,seewithkids,NINJA bot,Cutbot,BublupBot,BrandONbot,RidderBot,Taboolabot,Dubbotbot,FindITAnswersbot,infoobot,Refindbot,BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher,SeobilityBot,Cincraw,Dragonbot,VoluumDSP-content-bot,FreshRSS,BitBot,^PHP-Curl-Class,Google-Certificates-Bridge,centurybot,Viber,e\\.ventures Investment Crawler,evc-batch,PetalBot,virustotal,(^| )PTST\\/,minicrawler,Cookiebot,trovitBot,seostar\\.co,IonCrawl,Uptime-Kuma,SeekportBot,FreshpingBot,Feedbin,CriteoBot,Snap URL Preview Service,Better Uptime Bot,RuxitSynthetic,Google-Read-Aloud"
  const crawlers = crawlersList.split(",");

  const userAgent = event.getUseragent();
  const referrer = event.getRefr_urlhost() | "";
  
  let isKnownCrawler = false;
  let isKnownBot = false;
  
  // iterate over the list of bots and check if the user agent matches the bot
  for (let i = 0; i < bots.length; i++) {
    if (userAgent.match(bots[i])) {
      isKnownBot = true;
      break;
    }
  }

  // Only check for crawlers if the user agent is a known bot, because crawlers are a subset of bots
  if (isKnownBot) {
    for (let i = 0; i < crawlers.length; i++) {
      if (userAgent.match(crawlers[i])) {
        isKnownCrawler = true;
        break;
      }
    }
  }  
  
  // if traffic_quality is not empty, return it as a data context, otherwise return null
  return {
    schema: 'iglu:com.dumky.net/traffic_quality_context/jsonschema/1-0-0',
    data: {
      known_bot: isKnownBot,
      known_crawler: isKnownCrawler,
      known_cloud_provider_ip: undefined,
      low_quality_referrer: undefined
    }
  }
} 



function process(event) {
    let contexts = []

    contexts.push(processTrafficQuality(event))

    return contexts;
  }

  